name: Rust

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

env:
  CARGO_TERM_COLOR: always

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Build
      run: cargo build --verbose
    - name: Linting
      run: cargo clippy -- -D warnings -D clippy::pedantic -D clippy::nursery
    - name: Run tests
      run: cargo test --verbose
  deploy:
    runs-on: ubuntu-latest
    steps:
     - name: SSH into server and deploy
       uses: invi5H/ssh-action@v1
       with:
         SSH_HOST: ${{ secrets.SERVER_HOST }}
         SSH_USER: ${{ secrets.SERVER_USERNAME }}
         SSH_KEY: ${{ secrets.SERVER_KEY }}
         SSH_PORT: ${{ secrets.SERVER_PORT }}
     - run: ssh ${{ steps.ssh.outputs.SERVER }} ./deploy.sh   
